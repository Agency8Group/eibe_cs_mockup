<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>고객센터 테이블</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Segoe UI', 'Malgun Gothic', '맑은 고딕', Arial, sans-serif;
            padding: 0;
            margin: 0;
            background: #f5f5f7;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .main-wrapper {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .header-container {
            background: #ffffff;
            padding: 32px 40px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            margin-bottom: 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-content {
            flex: 1;
        }

        h1 {
            margin: 0 0 8px 0;
            color: #1d1d1f;
            font-weight: 700;
            letter-spacing: -0.8px;
            font-size: 36px;
            line-height: 1.2;
        }

        .version-info {
            font-size: 13px;
            color: #86868b;
            font-weight: 400;
            margin: 0;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .download-btn {
            background: #1d1d1f;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .download-btn:hover {
            background: #2c2c2e;
        }

        .download-btn:active {
            background: #1d1d1f;
        }

        .download-btn svg {
            width: 18px;
            height: 18px;
        }

        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                align-items: flex-start;
                padding: 24px;
            }

            .header-actions {
                width: 100%;
                justify-content: flex-end;
            }

            h1 {
                font-size: 28px;
            }
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #1d1d1f;
            margin: 0 0 20px 0;
            letter-spacing: -0.3px;
        }

        .form-section {
            background: #ffffff;
            padding: 32px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            margin-bottom: 32px;
        }

        .form-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 24px;
            align-items: flex-end;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #1d1d1f;
            font-size: 13px;
            letter-spacing: -0.1px;
            transition: color 0.2s ease;
        }

        .form-group label .required-note {
            color: #ff3b30;
            font-size: 11px;
            font-weight: 400;
        }

        .form-group select {
            width: 100%;
            padding: 14px 16px;
            font-size: 15px;
            border: 1px solid #d2d2d7;
            border-radius: 12px;
            background: #ffffff;
            color: #1d1d1f;
            cursor: pointer;
            outline: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23686868' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 12px;
            padding-right: 40px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .form-group select:hover {
            border-color: #a1a1a6;
            background-color: #fafafa;
        }

        .form-group select:focus {
            border-color: #007aff;
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
            background-color: #ffffff;
        }

        .form-group select:disabled {
            background-color: #f5f5f7;
            cursor: not-allowed;
            opacity: 0.5;
            border-color: #e5e5e7;
        }

        .form-group select option {
            padding: 12px;
            background: #ffffff;
            color: #1d1d1f;
        }

        .form-group input[type="text"] {
            width: 100%;
            padding: 14px 16px;
            font-size: 15px;
            border: 1px solid #d2d2d7;
            border-radius: 12px;
            background: #ffffff;
            color: #1d1d1f;
            outline: none;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .form-group input[type="text"]:hover {
            border-color: #a1a1a6;
            background-color: #fafafa;
        }

        .form-group input[type="text"]:focus {
            border-color: #007aff;
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
            background-color: #ffffff;
        }

        .form-group input[type="text"]:disabled {
            background-color: #f5f5f7;
            cursor: not-allowed;
            opacity: 0.5;
            border-color: #e5e5e7;
        }

        .form-group textarea {
            width: 100%;
            padding: 14px 16px;
            font-size: 15px;
            border: 1px solid #d2d2d7;
            border-radius: 12px;
            background: #ffffff;
            color: #1d1d1f;
            outline: none;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            resize: vertical;
            min-height: 150px;
            font-family: inherit;
            line-height: 1.5;
        }

        .form-group textarea:hover {
            border-color: #a1a1a6;
            background-color: #fafafa;
        }

        .form-group textarea:focus {
            border-color: #007aff;
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
            background-color: #ffffff;
        }

        .form-group textarea:disabled {
            background-color: #f5f5f7;
            cursor: not-allowed;
            opacity: 0.5;
            border-color: #e5e5e7;
        }

        .form-group-full-width {
            grid-column: 1 / -1;
        }

        .action-section {
            background: #ffffff;
            padding: 24px 32px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            margin-bottom: 32px;
            display: flex;
            justify-content: center;
        }

        .table-btn {
            background: #1d1d1f;
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 16px;
            font-weight: 500;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .table-btn:hover {
            background: #2c2c2e;
        }

        .table-btn:active {
            background: #1d1d1f;
        }

        .table-btn::before {
            content: '';
            width: 18px;
            height: 18px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='white' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .table-container {
            display: none;
            background: #ffffff;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            margin-bottom: 32px;
            animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .table-container.show {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 2px solid #f5f5f7;
        }

        .table-title {
            font-size: 28px;
            font-weight: 700;
            color: #1d1d1f;
            margin: 0;
            letter-spacing: -0.5px;
        }

        .close-btn {
            background: #86868b;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 500;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .close-btn:hover {
            background: #6e6e73;
        }

        .close-btn:active {
            background: #86868b;
        }

        .brand-section {
            margin-bottom: 48px;
        }

        .brand-section:last-child {
            margin-bottom: 0;
        }

        .brand-title {
            font-size: 22px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 24px;
            padding: 16px 24px;
            background: #f5f5f7;
            border-radius: 12px;
            letter-spacing: -0.3px;
            border-left: 4px solid #1d1d1f;
        }

        .category-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .category-table thead {
            background: #f5f5f7;
            color: #1d1d1f;
        }

        .category-table th {
            padding: 14px 16px;
            text-align: left;
            font-weight: 600;
            letter-spacing: -0.1px;
            font-size: 13px;
            text-transform: uppercase;
            color: #86868b;
        }

        .category-table td {
            padding: 12px 16px;
            border-bottom: 1px solid #e5e5e7;
            color: #1d1d1f;
        }

        .category-table tbody tr {
            transition: background 0.15s ease;
        }

        .category-table tbody tr:hover {
            background: #fafafa;
        }

        .category-table tbody tr:last-child td {
            border-bottom: none;
        }

        .middle-category {
            font-weight: 600;
            color: #007aff;
            background: #f0f7ff;
        }

        .sub-category {
            padding-left: 30px !important;
            color: #86868b;
        }

        .product-name {
            color: #86868b;
            font-size: 13px;
        }

        @media (max-width: 768px) {
            .main-wrapper {
                padding: 20px 16px;
            }

            .header-container {
                padding: 24px;
            }

            .form-section {
                padding: 24px;
            }

            .form-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .form-group {
                min-width: 100%;
            }

            .table-container {
                padding: 24px;
            }

            .category-table {
                font-size: 12px;
            }

            .category-table th,
            .category-table td {
                padding: 10px 12px;
            }

            .action-section {
                padding: 20px;
            }

            .table-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="main-wrapper">
        <div class="header-container">
            <div class="header-content">
                <h1>문의분류</h1>
                <div class="version-info">v0.0.6 · SKU 최신화 2025-12-03 기준</div>
            </div>
            <div class="header-actions">
                <button class="download-btn" onclick="downloadExcel()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    엑셀 다운로드
                </button>
            </div>
        </div>

        <div class="form-section">
            <h2 class="section-title">문의 분류 선택</h2>
            <div class="form-container">
        <!-- 1단계: 대분류 선택 (브랜드) -->
        <div class="form-group">
            <label for="mainCategory">대분류</label>
            <select id="mainCategory" onchange="onMainCategoryChange()">
                <option value="">선택하세요</option>
                <option value="dreame">드리미(dreame)</option>
                <option value="aptamil">압타밀(Aptamil)</option>
                <option value="fortimel">포티멜(Fortimel)</option>
                <option value="laylayt">레이레이(laylayt)</option>
            </select>
        </div>

        <!-- 2단계: 중분류 선택 -->
        <div class="form-group" id="middleCategoryGroup">
            <label for="middleCategory">중분류</label>
            <select id="middleCategory" onchange="onMiddleCategoryChange()" disabled>
                <option value="">선택하세요</option>
            </select>
        </div>

        <!-- 3단계: 소분류 선택 -->
        <div class="form-group" id="subCategoryGroup">
            <label for="subCategory">소분류</label>
            <select id="subCategory" onchange="onSubCategoryChange()" disabled>
                <option value="">선택하세요</option>
            </select>
        </div>

        <!-- 4단계: 제품명 선택 (대분류에 따라 변경) -->
        <div class="form-group" id="productNameGroup">
            <label for="productName">제품명</label>
            <select id="productName" onchange="onProductNameChange()" disabled>
                <option value="">선택하세요</option>
            </select>
        </div>

        <!-- 5단계: 상세옵션 입력 -->
        <div class="form-group" id="detailOptionGroup">
            <label for="detailOption">상세옵션<span class="required-note">(상세옵션 기재 가능한 섹션 구현필요)</span></label>
            <input type="text" id="detailOption" placeholder="상세옵션을 입력하세요" />
        </div>

        <!-- 6단계: 상담이력 기재란 -->
        <div class="form-group form-group-full-width" id="consultationHistoryGroup">
            <label for="consultationHistory">상담이력 기재란</label>
            <textarea id="consultationHistory" placeholder="상담이력을 입력하세요"></textarea>
        </div>
            </div>
        </div>

        <div class="action-section">
            <button class="table-btn" onclick="toggleTable()">전체 테이블 펼쳐보기</button>
        </div>

        <div class="table-container" id="tableContainer">
        <div class="table-header">
            <h2 class="table-title">전체 문의분류 테이블</h2>
            <button class="close-btn" onclick="toggleTable()">닫기</button>
        </div>
        <div id="tableContent"></div>
        </div>
    </div>

    <script>
        // 데이터 구조: 대분류(브랜드) > 중분류 > 소분류
        const categoryData = {
            dreame: {
                '배송문의': ['배송 지연', '오배송', '배송지 오기입', '수취인 부재', '송장 미등록', '기타'],
                '직배수 문의': ['설치방법', '기사방문일정', '작동불량', '누수'],
                '교환요청': ['제품 오염/이염', '제품 파손', '구성품 누락', '색상/옵션 오류', '초기불량', '클레임 사은품 지급', '기타'],
                '반품요청': ['단순 변심', '제품 오염/이염', '제품 파손', '오주문', '반품 후 환불 지연', '클레임 사은품 지급', '기타'],
                'AS접수': ['작동 불량', '부품 누락', '재포장 요청', '기타'],
                '사용문의': ['어플사용/연동', '제품사용', '소모품사용', '기타'],
                '기타문의': ['사은품 문의', 'CS 친절도', '기타']
            },
            aptamil: {
                '배송문의': ['배송 지연', '오배송', '배송지 오기입', '수취인 부재', '송장 미등록', '기타'],
                '직구관련 문의 (통관)': ['기타'],
                '교환요청': ['제품 오염/이염', '제품 파손', '이물질', '수량 오류', '기타'],
                '반품요청': ['단순 변심', '제품 오염/이염', '제품 파손', '유통기한 문제', '부분환불', '기타'],
                '환불요청': ['반품 후 환불 지연', '기타'],
                '기타문의': ['섭취관련 문의', '제품 성분 문의', '이벤트/사은품', '기타']
            },
            fortimel: {
                '배송문의': ['배송 지연', '오배송', '배송지 오기입', '수취인 부재', '송장 미등록', '기타'],
                '직구관련 문의 (통관)': ['기타'],
                '교환요청': ['제품 오염/이염', '제품 파손', '이물질', '수량 오류', '기타'],
                '반품요청': ['단순 변심', '제품 오염/이염', '제품 파손', '유통기한 문제', '부분환불', '기타'],
                '환불요청': ['반품 후 환불 지연', '기타'],
                '기타문의': ['섭취관련 문의', '제품 성분 문의', '이벤트/사은품', '기타']
            },
            laylayt: {
                '배송문의': ['배송 지연', '오배송', '배송지 오기입', '수취인 부재', '설치 일정 변경', '송장 미등록', '기타'],
                '교환요청': ['제품 오염/이염', '제품 파손', '구성품 누락', '색상/옵션 오류', '초기불량', '매트리스 결함', '프레임 불안정', '클레임 사은품 지급', '기타'],
                '반품요청': ['단순 변심', '제품 오염/이염', '제품 파손', '오주문', '사이즈 불일치', '반품 후 환불 지연', '클레임 사은품 지급', '기타'],
                'AS접수': ['조립 불량', '부품 누락', '프레임 불안정', '매트리스 결함', '재포장 요청', '기타'],
                '사용문의': ['침대 사용법', '매트리스 관리', '조립 방법', '제품 사양 문의', '기타'],
                '기타문의': ['사은품 문의', 'CS 친절도', '기타']
            }
        };

        // 제품명 데이터: 대분류에 따라 다른 제품명
        const productData = {
            dreame: [
                '(본품) Aqua10 Master',
                '(본품) Aqua10 Ultra',
                '(본품) Matrix10 Ultra (black)',
                '(본품) Matrix10 Ultra (white)',
                '(본품) X1 slim',
                '(본품) X1 air',
                '(본품) LIVO',
                '(본품) X50s Pro Ultra (Black)',
                '(본품) X50s Pro Master',
                '(본품) X50s Pro Ultra (White)',
                '(본품) X50 Master',
                '(본품) X50 Ultra (Black)',
                '(본품) X50 Ultra (White)',
                '(본품) X40 Ultra',
                '(본품) L10s Pro Ultra Heat',
                '(본품) L20 Ultra',
                '(본품) L10 Prime',
                '(본품) L10S Ultra',
                '직배수 키트',
                '악세사리 키트',
                '사이드 브러쉬',
                '메인 브러쉬',
                '물걸레 패드/롤러',
                '기타 소모품'
            ],
            aptamil: [
                '프로누트라 1단계',
                '프로누트라 2단계',
                '프로누트라 3단계',
                '프로푸트라 1단계',
                '프로푸트라 2단계',
                '프로푸트라 3단계',
                '뉴트리시아 네오케이트',
                '뉴트리시아 듀오칼',
                '뉴트리시아 인파트리니',
                '뉴트리시아 압타밀 펩티 시네오',
                '뉴트리시아 엘리멘탈 028 엑스트라 오렌지 100G',
                '뉴트리시아 피케이 에이드4 500G',
                '뉴트리시아 티와이알 아나믹스 400G',
                '뉴트리시아 엔케이에이치 아나믹스 400G',
                '뉴트리시아 로렌조 오일 500ML',
                '뉴트리시아 지에이1 아나믹스 인펀트 400g',
                '뉴트리시아 지에이1 아나믹스 주니어 400g',
                '뉴트리시아 엠에스유디 아나믹스 주니어 400g',
                '뉴트리시아 엠에스유디 맥사멈 500g',
                '뉴트리시아 로카솔 400g',
                '뉴트리시아 베이직 에프 300g',
                '뉴트리시아 엘리멘탈 028 엑스트라 바나나 100G',
                '뉴트리시아 엘리멘탈 028 엑스트라 무맛 100G',
                '(직구) 프로누트라 프레 Pronutra Pre',
                '(직구) 프로누트라 1단계 Pronutra 1',
                '(직구) 프로누트라 2단계 Pronutra 2',
                '(직구) 프로누트라 3단계 Pronutra 3',
                '(직구) 프로누트라 VP 1단계 Pronutra VP 1',
                '(직구) 프로누트라 VP 2단계 Pronutra VP 2',
                '(직구) 프로푸트라 프레 Profutura Pre',
                '(직구) 프로푸트라 1단계 Profutura 1',
                '(직구) 프로푸트라 1단계 Profutura 2',
                '(직구) TAB IF',
                '(직구) TAB FO',
                '(직구) 프로푸트라 킨더 1단계 Profutura Kinder 1',
                '(직구) 프로푸트라 킨더 1단계 Profutura Kinder 2',
                '(직구) AR',
                '(직구) Comfort',
                '(직구) 3PF 1+IF',
                '(직구) 3PF 2+FO',
                '(직구) 3PN2+FO',
                '(직구) 3PN PRE +IF',
                '(직구) 3PF PRE +IF',
                '(직구) 3PN1+IF'
            ],
            fortimel: [
                '포티멜 프로틴 바닐라향',
                '(직구) 포티멜 컴팩트 프로틴 모카 Fortimel Compact Protein Mocha',
                '(직구) 포티멜 컴팩트 프로틴 뉴트럴(무맛) Fortimel Compact Protein Neu',
                '(직구) 포티멜 컴팩트 프로틴 쿨 레드프루트맛 Fortimel Compact Protein Cool Redfruit',
                '(직구) 포티멜 컴팩트 프로틴 핫 진저맛 Fortimel Compact Protein Hot Ginger'
            ],
            laylayt: [
                '(매트리스) 레이레이 LAYZ-1 픽셀 스프링 매트리스',
                '(매트리스) 레이레이 LAYZ-1 픽셀 스프링 하이브리드 매트리스',
                '(매트리스) 레이레이 LAYZ-2 픽셀 스프링 매트리스',
                '(매트리스) 레이레이 LAYZ-2 픽셀 스프링 하이브리드 매트리스',
                '(매트리스) 레이레이 LAYZ-3 픽셀 스프링 매트리스',
                '(매트리스) 레이레이 LAYZ-3 픽셀 스프링 하이브리드 매트리스',
                '(토퍼) 레이레이 T5 메모리폼 토퍼',
                '(토퍼) 레이레이 T10 메모리폼 토퍼',
                '(필로우) 레이레이 스프링 필로우',
                '(필로우) 레이레이 메모리폼 필로우',
                '(침구) 레이레이 매트리스 커버',
                '(침구) 레이레이 침대 패드'
            ]
        };

        // 대분류 변경 시
        function onMainCategoryChange() {
            const mainCategory = document.getElementById('mainCategory').value;
            const middleCategorySelect = document.getElementById('middleCategory');
            const subCategorySelect = document.getElementById('subCategory');
            const productNameSelect = document.getElementById('productName');

            // 초기화
            middleCategorySelect.innerHTML = '<option value="">선택하세요</option>';
            subCategorySelect.innerHTML = '<option value="">선택하세요</option>';
            productNameSelect.innerHTML = '<option value="">선택하세요</option>';
            
            // 비활성화
            middleCategorySelect.disabled = true;
            subCategorySelect.disabled = true;
            productNameSelect.disabled = true;

            if (mainCategory) {
                // 중분류 옵션 추가
                if (categoryData[mainCategory]) {
                    const middleCategories = Object.keys(categoryData[mainCategory]);
                    middleCategories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        middleCategorySelect.appendChild(option);
                    });
                    middleCategorySelect.disabled = false;
                }

                // 제품명 옵션 추가
                if (productData[mainCategory]) {
                    productData[mainCategory].forEach(product => {
                        const option = document.createElement('option');
                        option.value = product;
                        option.textContent = product;
                        productNameSelect.appendChild(option);
                    });
                    productNameSelect.disabled = false;
                }
            }
        }

        // 중분류 변경 시
        function onMiddleCategoryChange() {
            const mainCategory = document.getElementById('mainCategory').value;
            const middleCategory = document.getElementById('middleCategory').value;
            const subCategorySelect = document.getElementById('subCategory');

            // 초기화
            subCategorySelect.innerHTML = '<option value="">선택하세요</option>';
            subCategorySelect.disabled = true;

            if (mainCategory && middleCategory && categoryData[mainCategory] && categoryData[mainCategory][middleCategory]) {
                // 소분류 옵션 추가
                const subCategories = categoryData[mainCategory][middleCategory];
                subCategories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    subCategorySelect.appendChild(option);
                });
                subCategorySelect.disabled = false;
            }
        }

        // 소분류 변경 시
        function onSubCategoryChange() {
            const mainCategory = document.getElementById('mainCategory').value;
            const middleCategory = document.getElementById('middleCategory').value;
            const subCategory = document.getElementById('subCategory').value;
            
            // 선택된 값들을 콘솔에 출력 (실제 사용 시 여기에 로직 추가)
            if (mainCategory && middleCategory && subCategory) {
                console.log('선택된 분류:', mainCategory, '>', middleCategory, '>', subCategory);
            }
        }

        // 제품명 변경 시 (별개 로직)
        function onProductNameChange() {
            const productName = document.getElementById('productName').value;
            
            // 선택된 제품명을 콘솔에 출력 (실제 사용 시 여기에 로직 추가)
            if (productName) {
                console.log('선택된 제품명:', productName);
            }
        }

        // 상세옵션 변경 시
        function onDetailOptionChange() {
            const detailOption = document.getElementById('detailOption').value;
            
            // 입력된 상세옵션을 콘솔에 출력 (실제 사용 시 여기에 로직 추가)
            if (detailOption) {
                console.log('입력된 상세옵션:', detailOption);
            }
        }

        // 상담이력 변경 시
        function onConsultationHistoryChange() {
            const consultationHistory = document.getElementById('consultationHistory').value;
            
            // 입력된 상담이력을 콘솔에 출력 (실제 사용 시 여기에 로직 추가)
            if (consultationHistory) {
                console.log('입력된 상담이력:', consultationHistory);
            }
        }

        // 상세옵션 입력 필드 이벤트 리스너 추가
        document.addEventListener('DOMContentLoaded', function() {
            const detailOptionInput = document.getElementById('detailOption');
            if (detailOptionInput) {
                detailOptionInput.addEventListener('input', onDetailOptionChange);
            }
            
            const consultationHistoryTextarea = document.getElementById('consultationHistory');
            if (consultationHistoryTextarea) {
                consultationHistoryTextarea.addEventListener('input', onConsultationHistoryChange);
            }
        });

        // 테이블 토글
        function toggleTable() {
            const container = document.getElementById('tableContainer');
            container.classList.toggle('show');
            
            if (container.classList.contains('show')) {
                renderTable();
            }
        }

        // 테이블 렌더링
        function renderTable() {
            const content = document.getElementById('tableContent');
            let html = '';

            // 각 브랜드별로 테이블 생성
            Object.keys(categoryData).forEach(brand => {
                const brandNameMap = {
                    dreame: '드리미(dreame)',
                    aptamil: '압타밀(Aptamil)',
                    fortimel: '포티멜(Fortimel)',
                    laylayt: '레이레이(laylayt)'
                };
                const brandName = brandNameMap[brand] || brand;
                const products = productData[brand];
                
                html += `<div class="brand-section">`;
                html += `<div class="brand-title">${brandName}</div>`;
                html += `<table class="category-table">`;
                html += `<thead><tr><th style="width: 15%;">대분류</th><th style="width: 20%;">중분류</th><th style="width: 40%;">소분류</th><th style="width: 25%;">제품명</th></tr></thead>`;
                html += `<tbody>`;

                // 중분류별로 순회
                Object.keys(categoryData[brand]).forEach(middleCategory => {
                    const subCategories = categoryData[brand][middleCategory];
                    const rowspan = subCategories.length;
                    
                    subCategories.forEach((subCategory, index) => {
                        html += `<tr>`;
                        
                        // 첫 번째 행에만 대분류와 중분류 표시
                        if (index === 0) {
                            html += `<td rowspan="${rowspan}" style="font-weight: 600; color: #2c3e50; vertical-align: top; padding-top: 16px;">${brandName}</td>`;
                            html += `<td rowspan="${rowspan}" class="middle-category" style="vertical-align: top; padding-top: 16px;">${middleCategory}</td>`;
                        }
                        
                        html += `<td class="sub-category">${subCategory}</td>`;
                        
                        // 첫 번째 행에만 제품명 표시
                        if (index === 0) {
                            html += `<td rowspan="${rowspan}" class="product-name" style="vertical-align: top; padding-top: 16px;">${products.join(', ')}</td>`;
                        }
                        
                        html += `</tr>`;
                    });
                });

                html += `</tbody>`;
                html += `</table>`;
                html += `</div>`;
            });

            content.innerHTML = html;
        }

        // 엑셀 다운로드 함수
        function downloadExcel() {
            try {
                // 워크북 생성
                const wb = XLSX.utils.book_new();
                
                // 각 브랜드별로 시트 생성
                Object.keys(categoryData).forEach(brand => {
                    const brandNameMap = {
                        dreame: '드리미(dreame)',
                        aptamil: '압타밀(Aptamil)',
                        fortimel: '포티멜(Fortimel)',
                        laylayt: '레이레이(laylayt)'
                    };
                    const brandName = brandNameMap[brand] || brand;
                    const products = productData[brand];
                    
                    // 데이터 배열 생성
                    const data = [];
                    
                    // 헤더 추가
                    data.push(['대분류', '중분류', '소분류', '제품명']);
                    
                    // 각 중분류별로 데이터 추가
                    Object.keys(categoryData[brand]).forEach(middleCategory => {
                        const subCategories = categoryData[brand][middleCategory];
                        
                        subCategories.forEach((subCategory, index) => {
                            const row = [];
                            
                            // 첫 번째 행에만 대분류와 중분류 표시
                            if (index === 0) {
                                row.push(brandName);
                                row.push(middleCategory);
                            } else {
                                row.push('');
                                row.push('');
                            }
                            
                            row.push(subCategory);
                            
                            // 첫 번째 행에만 제품명 표시
                            if (index === 0) {
                                row.push(products.join(', '));
                            } else {
                                row.push('');
                            }
                            
                            data.push(row);
                        });
                    });
                    
                    // 워크시트 생성
                    const ws = XLSX.utils.aoa_to_sheet(data);
                    
                    // 컬럼 너비 설정
                    ws['!cols'] = [
                        { wch: 20 }, // 대분류
                        { wch: 25 }, // 중분류
                        { wch: 30 }, // 소분류
                        { wch: 80 }  // 제품명
                    ];
                    
                    // 시트를 워크북에 추가
                    XLSX.utils.book_append_sheet(wb, ws, brandName);
                });
                
                // 파일명 생성 (현재 날짜 포함)
                const today = new Date();
                const dateStr = today.getFullYear() + 
                               String(today.getMonth() + 1).padStart(2, '0') + 
                               String(today.getDate()).padStart(2, '0');
                const fileName = `문의분류_${dateStr}.xlsx`;
                
                // 엑셀 파일 다운로드
                XLSX.writeFile(wb, fileName);
                
            } catch (error) {
                console.error('엑셀 다운로드 중 오류 발생:', error);
                alert('엑셀 다운로드 중 오류가 발생했습니다. 콘솔을 확인해주세요.');
            }
        }
    </script>
</body>
</html>
